<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>设备代码管理 - 账户管理系统</title>
    <link href="../static/css/index.css" rel="stylesheet">
    <link href="../static/css/pade_code.css" rel="stylesheet">
</head>
<body>
<div class="pad-container">
    <div class="pad-header">
        <h1>📱 设备代码管理</h1>
        <div class="action-buttons">
            <button class="refresh-btn" id="refreshBtn" onclick="loadAvailablePadCodes()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" id="refreshIcon">
                    <polyline points="23 4 23 10 17 10"></polyline>
                    <polyline points="1 20 1 14 7 14"></polyline>
                    <path d="m3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                </svg>
                刷新云端数据
            </button>
            <button class="secondary" onclick="window.location.href='/config'">⚙️ 配置管理</button>
            <button class="secondary" onclick="window.location.href='/'">返回主页</button>
        </div>
    </div>

    <!-- 错误/成功消息 -->
    <div class="error" id="error" style="display: none;">
        <svg fill="currentColor" height="20" viewBox="0 0 20 20" width="20">
            <path clip-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                  fill-rule="evenodd"/>
        </svg>
        <span id="errorMessage"></span>
    </div>

    <div class="error" id="success" style="display: none; background-color: #d4edda; color: #155724;">
        <svg fill="currentColor" height="20" viewBox="0 0 20 20" width="20">
            <path clip-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  fill-rule="evenodd"/>
        </svg>
        <span id="successMessage"></span>
    </div>

    <!-- 统计信息 -->
    <div class="stats-cards" id="statsCards">
        <!-- 通过 JavaScript 动态填充 -->
    </div>

    <!-- 标签页 -->
    <div class="tabs-container">
        <button class="tab-btn active" onclick="switchTab('available')">🌐 云端可用设备</button>
        <button class="tab-btn" onclick="switchTab('current')">📋 当前配置设备</button>
        <button class="tab-btn" onclick="switchTab('compare')">🔍 差异对比</button>
    </div>

    <!-- 云端可用设备标签页 -->
    <div id="availableTab" class="tab-content active">
        <!-- 控制区域 -->
        <div class="controls-row">
            <input type="text" class="search-input" id="searchInput" placeholder="搜索设备代码、名称或IP...">
            <select class="filter-select" id="statusFilter">
                <option value="">所有状态</option>
                <option value="1">在线</option>
                <option value="0">离线</option>
            </select>
            <select class="filter-select" id="configFilter">
                <option value="">所有设备</option>
                <option value="true">已在配置中</option>
                <option value="false">未在配置中</option>
            </select>
            <button id="applyFilters">应用筛选</button>
            <button class="secondary" id="resetFilters">重置筛选</button>
        </div>

        <!-- 增强的批量操作控制 -->
        <div class="selection-controls">
            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="selectAll"> 全选
                </label>
                <span class="selected-count" id="selectedCount">已选择: 0</span>

                <!-- 快速选择按钮 -->
                <div class="quick-select-buttons" style="display: flex; gap: 8px; flex-wrap: wrap;">
                    <button id="selectNotInConfig" class="secondary small-btn">选择未配置</button>
                    <button id="selectOnlineOnly" class="secondary small-btn">选择在线设备</button>
                    <button id="selectOfflineOnly" class="secondary small-btn">选择离线设备</button>
                    <button id="selectByAndroidVersion" class="secondary small-btn">按Android版本选择</button>
                </div>
            </div>
        </div>

        <!-- 改进的批量操作区域 -->
        <div class="bulk-actions" id="bulkActions">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px;">
                <h4>批量操作 - 选中 <span id="bulkSelectedCount">0</span> 台设备</h4>
                <button onclick="clearSelection()" class="secondary small-btn">清空选择</button>
            </div>

            <div class="bulk-action-grid">
                <!-- 导入操作 -->
                <div class="action-group">
                    <h5>📥 导入操作</h5>
                    <div class="action-buttons">
                        <button onclick="importSelectedDevices('add')" class="add-btn">
                            ➕ 添加到配置
                        </button>
                        <button onclick="importSelectedDevices('sync')" class="add-btn">
                            🔄 同步到配置
                        </button>
                    </div>
                </div>

                <!-- 筛选导入 -->
                <div class="action-group">
                    <h5>🎯 条件导入</h5>
                    <div class="action-buttons">
                        <button onclick="importOnlineOnly()" class="add-btn">
                            📡 仅导入在线设备
                        </button>
                        <button onclick="importByAndroidVersion()" class="add-btn">
                            🤖 按Android版本导入
                        </button>
                    </div>
                </div>

                <!-- 移除操作 -->
                <div class="action-group">
                    <h5>🗑️ 移除操作</h5>
                    <div class="action-buttons">
                        <button onclick="removeSelectedCodes()" class="remove-btn">
                            ➖ 从配置移除
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 设备表格 -->
        <div class="table-container" style="position: relative;">
            <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                <div class="loading">
                    <svg fill="var(--primary-color)" height="24" style="animation: spin 1s linear infinite;" viewBox="0 0 24 24" width="24">
                        <path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/>
                        <path d="M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"/>
                    </svg>
                    <div style="margin-left: 10px;">加载中...</div>
                </div>
            </div>

            <table class="pad-table" id="availableTable">
                <thead>
                <tr>
                    <th class="checkbox-cell">
                        <input type="checkbox" id="headerSelectAll" onchange="toggleSelectAllFromHeader()">
                    </th>
                    <th>设备代码</th>
                    <th>设备名称</th>
                    <th>状态</th>
                    <th>配置状态</th>
                    <th>Android版本</th>
                    <th>设备信息</th>
                    <th>配置名称</th>
                    <th>到期时间</th>
                    <th>启动时间</th>
                    <th>单独操作</th>
                </tr>
                </thead>
                <tbody id="availableTableBody">
                <!-- 通过 JavaScript 动态填充 -->
                </tbody>
            </table>

            <!-- 空状态 -->
            <div class="empty-state" id="availableEmptyState" style="display: none;">
                <svg fill="none" height="48" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" width="48">
                    <path d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.347a1.125 1.125 0 0 1 0 1.972l-11.54 6.347a1.125 1.125 0 0 1-1.667-.986V5.653Z" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h3>暂无可用设备</h3>
                <p>云端没有找到可用的设备代码</p>
            </div>
        </div>

        <!-- 全局快速操作 -->
        <div class="global-actions" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <h4>🚀 全局快速操作</h4>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                <button onclick="syncAllAvailable()" class="add-btn">
                    🔄 导入所有可用设备
                </button>
                <button onclick="syncOnlineOnly()" class="add-btn">
                    📡 仅导入在线设备
                </button>
                <button onclick="syncNotInConfig()" class="add-btn">
                    🆕 仅导入未配置设备
                </button>
                <button onclick="showAdvancedImportDialog()" class="secondary">
                    ⚙️ 高级导入选项
                </button>
            </div>
        </div>
    </div>

    <!-- 当前配置标签页 -->
    <div id="currentTab" class="tab-content">
        <div class="controls-row">
            <input type="text" class="search-input" id="currentSearchInput" placeholder="搜索当前配置的设备代码...">
            <button id="applyCurrentFilters">搜索</button>
            <button class="secondary" id="resetCurrentFilters">重置</button>
        </div>

        <div class="table-container" style="position: relative;">
            <table class="pad-table" id="currentTable">
                <thead>
                <tr>
                    <th class="checkbox-cell">选择</th>
                    <th>设备代码</th>
                    <th>云端状态</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody id="currentTableBody">
                <!-- 通过 JavaScript 动态填充 -->
                </tbody>
            </table>

            <div class="empty-state" id="currentEmptyState" style="display: none;">
                <svg fill="none" height="48" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24" width="48">
                    <path d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a6.759 6.759 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <h3>暂无配置</h3>
                <p>当前配置中没有设备代码</p>
            </div>
        </div>

        <!-- 当前配置操作 -->
        <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
            <button onclick="removeSelectedFromConfig()" class="remove-btn">🗑️ 移除选中设备</button>
            <button onclick="validateCurrentConfig()" class="secondary">✅ 验证配置有效性</button>
        </div>
    </div>

    <!-- 差异对比标签页 -->
    <div id="compareTab" class="tab-content">
        <div style="margin-bottom: 20px;">
            <button onclick="loadComparison()" class="refresh-btn">🔄 刷新对比数据</button>
        </div>

        <!-- 对比统计 -->
        <div class="comparison-grid" id="comparisonGrid">
            <!-- 通过 JavaScript 动态填充 -->
        </div>

        <!-- 同步建议 -->
        <div class="sync-recommendations" id="syncRecommendations" style="display: none;">
            <!-- 通过 JavaScript 动态填充 -->
        </div>

        <!-- 危险操作区域 -->
        <div class="danger-zone">
            <h4>⚠️ 危险操作</h4>
            <p>以下操作会完全替换当前配置，请谨慎使用：</p>
            <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button onclick="replaceWithCloudCodes()" class="remove-btn">🔄 用云端代码完全替换本地配置</button>
                <button onclick="clearAllCodes()" class="remove-btn">🗑️ 清空所有设备代码</button>
            </div>
        </div>
    </div>
</div>

<!-- 高级导入对话框 -->
<div id="advancedImportModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>⚙️ 高级导入选项</h3>
            <button class="modal-close" onclick="closeAdvancedImportDialog()">&times;</button>
        </div>
        <div class="modal-body">
            <div class="form-group">
                <label>
                    <input type="checkbox" id="onlineOnlyCheck"> 仅导入在线设备
                </label>
            </div>
            <div class="form-group">
                <label>Android版本筛选:</label>
                <select id="androidVersionSelect">
                    <option value="">所有版本</option>
                    <!-- 动态填充 -->
                </select>
            </div>
            <div class="form-group">
                <label>导入模式:</label>
                <select id="importModeSelect">
                    <option value="add">添加到现有配置</option>
                    <option value="replace">替换现有配置</option>
                </select>
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="excludeConfiguredCheck"> 排除已配置的设备
                </label>
            </div>
        </div>
        <div class="modal-footer">
            <button onclick="executeAdvancedImport()" class="add-btn">开始导入</button>
            <button onclick="closeAdvancedImportDialog()" class="secondary">取消</button>
        </div>
    </div>
</div>

<script src="../static/js/pade_code.js"></script>
</body>
</html>
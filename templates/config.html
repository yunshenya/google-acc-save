<!DOCTYPE html>
<html lang="zh-CN" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>配置管理 - 账户管理系统</title>
    <link href="../static/css/index.css" rel="stylesheet">
    <link href="../static/css/config.css" rel="stylesheet">
    <link href="../static/css/comm.css" rel="stylesheet">
</head>
<body>
<div class="config-container">
    <div class="config-header">
        <h1>⚙️ 系统配置管理</h1>
        <div class="config-actions">
            <button id="validateBtn" class="validate-btn">验证配置</button>
            <button id="backupBtn" class="secondary">💾 备份配置</button>
            <button id="resetBtn" class="reset-btn">重置默认</button>
            <button id="saveBtn" class="save-btn">保存配置</button>
            <button class="secondary" onclick="window.location.href='/'">返回主页</button>
        </div>
    </div>

    <!-- 错误/成功消息 -->
    <div class="error" id="error" style="display: none;">
        <svg fill="currentColor" height="20" viewBox="0 0 20 20" width="20">
            <path clip-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z"
                  fill-rule="evenodd"/>
        </svg>
        <span id="errorMessage"></span>
    </div>

    <div class="error" id="success" style="display: none; background-color: #d4edda; color: #155724;">
        <svg fill="currentColor" height="20" viewBox="0 0 20 20" width="20">
            <path clip-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                  fill-rule="evenodd"/>
        </svg>
        <span id="successMessage"></span>
    </div>

    <!-- 验证状态 -->
    <div id="validationStatus" style="display: none;"></div>

    <!-- 配置标签页 -->
    <div class="config-tabs">
        <button class="tab-btn active" onclick="switchTab('basic')">🔧 基础配置</button>
        <button class="tab-btn" onclick="switchTab('security')">🔐 安全配置</button>
        <button class="tab-btn" onclick="switchTab('environment')">🌍 环境变量</button>
        <button class="tab-btn" onclick="switchTab('backup')">💾 备份管理</button>
    </div>

    <!-- 基础配置标签页 -->
    <div id="basicTab" class="tab-content active">
        <!-- 设备代码配置 -->
        <div class="config-section">
            <h3>📱 设备代码配置</h3>
            <div class="form-group">
                <label>设备代码列表</label>
                <div class="array-input" id="padCodesContainer">
                    <!-- 动态生成 -->
                </div>
                <button type="button" class="add-btn" onclick="addPadCode()">+ 添加设备代码</button>
            </div>
        </div>

        <!-- 包名配置 -->
        <div class="config-section">
            <h3>📦 应用包名配置</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>主要包名</label>
                    <input type="text" id="primaryPackage" placeholder="com.example.primary">
                </div>
                <div class="form-group">
                    <label>次要包名</label>
                    <input type="text" id="secondaryPackage" placeholder="com.example.secondary">
                </div>
            </div>
        </div>

        <!-- 模板ID配置 -->
        <div class="config-section">
            <h3>🎯 模板ID配置</h3>
            <div class="form-group">
                <label>模板ID列表</label>
                <div class="array-input" id="templeIdsContainer">
                    <!-- 动态生成 -->
                </div>
                <button type="button" class="add-btn" onclick="addTempleId()">+ 添加模板ID</button>
            </div>
        </div>

        <!-- 默认代理配置 -->
        <div class="config-section">
            <h3>🌐 默认代理配置</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>国家</label>
                    <input type="text" id="proxyCountry" placeholder="摩洛哥">
                </div>
                <div class="form-group">
                    <label>国家代码</label>
                    <input type="text" id="proxyCode" placeholder="ma">
                </div>
                <div class="form-group">
                    <label>代理URL</label>
                    <input type="url" id="proxyUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>时区</label>
                    <input type="text" id="proxyTimezone" placeholder="Africa/Casablanca">
                </div>
                <div class="form-group">
                    <label>语言</label>
                    <input type="text" id="proxyLanguage" placeholder="English">
                </div>
                <div class="form-group">
                    <label>纬度</label>
                    <input type="number" id="proxyLatitude" step="0.0001" min="-90" max="90" placeholder="35.7758">
                </div>
                <div class="form-group">
                    <label>经度</label>
                    <input type="number" id="proxyLongitude" step="0.0001" min="-180" max="180" placeholder="-5.7909">
                </div>
            </div>
        </div>

        <!-- 应用URL配置 -->
        <div class="config-section">
            <h3>🔗 应用下载链接配置</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>Clash 下载链接</label>
                    <input type="url" id="clashUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Script 下载链接</label>
                    <input type="url" id="scriptUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Script2 下载链接</label>
                    <input type="url" id="script2Url" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Chrome 下载链接</label>
                    <input type="url" id="chromeUrl" placeholder="https://...">
                </div>
            </div>
        </div>

        <!-- 超时配置 -->
        <div class="config-section">
            <h3>⏱️ 超时配置</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>全局超时时间（分钟）</label>
                    <input type="number" id="globalTimeout" min="1" max="120" placeholder="12">
                </div>
                <div class="form-group">
                    <label>任务检查超时时间（分钟）</label>
                    <input type="number" id="checkTaskTimeout" min="1" max="60" placeholder="5">
                </div>
            </div>
        </div>

        <!-- 调试配置 -->
        <div class="config-section">
            <h3>🐛 调试配置</h3>
            <div class="form-group">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="debugMode" style="width: auto;">
                    启用调试模式
                </label>
            </div>
        </div>
    </div>

    <!-- 安全配置标签页 -->
    <div id="securityTab" class="tab-content">
        <div class="config-section">
            <h3>🔐 JWT 配置</h3>
            <div class="form-group">
                <label>JWT 密钥</label>
                <input type="password" id="jwtSecretKey" placeholder="请输入JWT密钥">
                <small style="color: var(--dark-gray);">建议长度至少32个字符</small>
            </div>
        </div>

        <div class="config-section">
            <h3>👤 管理员账户</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label>管理员用户名</label>
                    <input type="text" id="adminUsername" placeholder="admin">
                </div>
                <div class="form-group">
                    <label>管理员密码</label>
                    <input type="password" id="adminPassword" placeholder="请输入密码">
                    <small style="color: var(--dark-gray);">建议长度至少6个字符</small>
                </div>
            </div>
        </div>

        <div class="config-section">
            <h3>🗄️ 数据库配置</h3>
            <div class="form-group">
                <label>数据库连接URL</label>
                <input type="text" id="databaseUrl" placeholder="postgresql+asyncpg://user:password@host:port/database">
            </div>
        </div>
    </div>

    <!-- 环境变量标签页 -->
    <div id="environmentTab" class="tab-content">
        <div class="config-section">
            <h3>🌍 环境变量管理</h3>

            <div class="form-group">
                <label>添加新的环境变量</label>
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <input type="text" id="newEnvKey" placeholder="变量名" style="flex: 1;">
                    <input type="text" id="newEnvValue" placeholder="变量值" style="flex: 2;">
                    <button type="button" onclick="addEnvVar()" class="add-btn">添加</button>
                </div>
            </div>

            <div class="form-group">
                <label>当前环境变量</label>
                <table class="env-var-table" id="envVarTable">
                    <thead>
                    <tr>
                        <th>变量名</th>
                        <th>变量值</th>
                        <th>类型</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                    <tbody id="envVarTableBody">
                    <!-- 动态填充 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- 备份管理标签页 -->
    <div id="backupTab" class="tab-content">
        <div class="config-section">
            <h3>💾 配置备份</h3>
            <div style="margin-bottom: 20px;">
                <button type="button" onclick="createBackup()" class="add-btn">🔄 创建新备份</button>
                <button type="button" onclick="loadBackups()" class="secondary" style="margin-left: 10px;">🔄 刷新列表</button>
            </div>

            <div id="backupList">
                <!-- 动态填充备份列表 -->
            </div>
        </div>

        <div class="danger-zone">
            <h3>⚠️ 危险区域</h3>
            <p>以下操作可能影响系统稳定性，请谨慎操作：</p>
            <div style="margin-top: 15px;">
                <button type="button" onclick="confirmReset()" class="remove-btn">🔄 重置所有配置</button>
                <button type="button" onclick="clearAllEnvVars()" class="remove-btn" style="margin-left: 10px;">🗑️ 清空自定义环境变量</button>
            </div>
        </div>
    </div>
</div>

<!-- 加载遮罩 -->
<div class="loading-overlay" id="loadingOverlay" style="display: none;">
    <div class="loading">
        <svg fill="var(--primary-color)" height="24" style="animation: spin 1s linear infinite;" viewBox="0 0 24 24" width="24">
            <path d="M12,1A11,11,0,1,0,23,12,11,11,0,0,0,12,1Zm0,19a8,8,0,1,1,8-8A8,8,0,0,1,12,20Z" opacity=".25"/>
            <path d="M12,4a8,8,0,0,1,7.89,6.7A1.53,1.53,0,0,0,21.38,12h0a1.5,1.5,0,0,0,1.48-1.75,11,11,0,0,0-21.72,0A1.5,1.5,0,0,0,2.62,12h0a1.53,1.53,0,0,0,1.49-1.3A8,8,0,0,1,12,4Z"/>
        </svg>
        <div style="margin-left: 10px;">处理中...</div>
    </div>
</div>
<script src="../static/js/comm.js"></script>
<script src="../static/js/config.js"></script>
</body>
</html>